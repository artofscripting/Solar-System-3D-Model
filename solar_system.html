<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Solar System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #0a0a0a;
            color: #fff;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid #2a2a4a;
        }

        .header h1 {
            font-size: 24px;
            background: linear-gradient(45deg, #ffd700, #ff6b35, #ff3366);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-controls {
            margin-left: auto;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-controls label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #aaa;
        }

        .header-controls input[type="range"] {
            width: 100px;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 250px;
            height: calc(100vh - 60px);
            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
            padding: 20px;
            z-index: 99;
            overflow-y: auto;
            border-right: 1px solid #2a2a4a;
        }

        .sidebar h2 {
            font-size: 16px;
            color: #888;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .planet-list {
            list-style: none;
        }

        .planet-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .planet-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .planet-item.active {
            background: rgba(255, 215, 0, 0.2);
            border-left: 3px solid #ffd700;
        }

        .planet-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 12px;
            box-shadow: 0 0 10px currentColor;
        }

        .planet-info {
            flex: 1;
        }

        .planet-name {
            font-size: 14px;
            font-weight: 600;
        }

        .planet-distance {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }

        /* Main content */
        .main-content {
            position: fixed;
            top: 60px;
            left: 250px;
            right: 0;
            bottom: 0;
        }

        #solar-system {
            width: 100%;
            height: 100%;
        }

        /* Info panel */
        .info-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #2a2a4a;
            max-width: 380px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            display: none;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .info-panel.visible {
            display: block;
        }

        .info-panel h3 {
            color: #ffd700;
            margin-bottom: 5px;
            font-size: 20px;
        }

        .info-panel .info-type {
            color: #888;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .info-panel .info-description {
            font-size: 13px;
            color: #ccc;
            line-height: 1.6;
            margin-bottom: 15px;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
        }

        .info-panel .info-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .info-panel .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
        }

        .info-panel .stat-label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-panel .stat-value {
            font-size: 14px;
            color: #fff;
            font-weight: bold;
            margin-top: 3px;
        }

        .info-panel .stat-unit {
            font-size: 11px;
            color: #888;
            font-weight: normal;
        }

        .info-panel .info-facts {
            margin-bottom: 15px;
        }

        .info-panel .info-facts h4 {
            color: #aaa;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .info-panel .info-facts ul {
            list-style: none;
            padding: 0;
        }

        .info-panel .info-facts li {
            font-size: 12px;
            color: #999;
            padding: 4px 0;
            padding-left: 15px;
            position: relative;
        }

        .info-panel .info-facts li::before {
            content: '‚Ä¢';
            color: #ffd700;
            position: absolute;
            left: 0;
        }

        .info-panel .wiki-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #1a5fb4, #3584e4);
            color: white;
            text-decoration: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            justify-content: center;
        }

        .info-panel .wiki-link:hover {
            background: linear-gradient(135deg, #2a6fc4, #4594f4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(53, 132, 228, 0.4);
        }

        .info-panel::-webkit-scrollbar {
            width: 6px;
        }

        .info-panel::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .info-panel::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 3px;
        }

        /* Tour button */
        .tour-button {
            background: linear-gradient(135deg, #4a00e0, #8e2de2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(142, 45, 226, 0.4);
        }

        .tour-button:hover {
            background: linear-gradient(135deg, #5a10f0, #9e3df2);
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(142, 45, 226, 0.6);
        }

        .tour-button.active {
            background: linear-gradient(135deg, #e04a00, #e22d8e);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 2px 10px rgba(226, 45, 142, 0.4); }
            50% { box-shadow: 0 4px 20px rgba(226, 45, 142, 0.8); }
        }

        /* Tour progress indicator */
        .tour-progress {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 26, 46, 0.95);
            padding: 15px 25px;
            border-radius: 30px;
            display: none;
            align-items: center;
            gap: 15px;
            z-index: 100;
            border: 1px solid #4a00e0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .tour-progress.active {
            display: flex;
        }

        .tour-progress-text {
            font-size: 16px;
            font-weight: bold;
            background: linear-gradient(45deg, #ffd700, #ff6b35);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tour-progress-bar {
            width: 150px;
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
        }

        .tour-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a00e0, #8e2de2);
            transition: width 0.3s ease;
        }

        /* Controls hint */
        .controls-hint {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(26, 26, 46, 0.9);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            color: #666;
        }

        .controls-hint kbd {
            background: #333;
            padding: 2px 6px;
            border-radius: 3px;
            margin: 0 2px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>üåå 3D Solar System</h1>
        <div class="header-controls">
            <label>
                Speed:
                <input type="range" id="speed-control" min="0" max="5" step="0.1" value="1">
            </label>
            <label>
                <input type="checkbox" id="orbit-toggle" checked>
                Show Orbits
            </label>
            <label>
                <input type="checkbox" id="labels-toggle" checked>
                Show Labels
            </label>
            <label style="color: #99ff99;">
                <input type="checkbox" id="asteroids-toggle" checked>
                Asteroids
            </label>
            <label style="color: #aaddff;">
                <input type="checkbox" id="comets-toggle" checked>
                Comets
            </label>
            <label style="color: #ffcc66;">
                <input type="checkbox" id="vortex-toggle">
                Vortex Mode
            </label>
            <button id="tour-btn" class="tour-button">üöÄ Start Tour</button>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar">
        <h2>Celestial Bodies</h2>
        <ul class="planet-list" id="planet-list">
            <!-- Populated by JavaScript -->
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div id="solar-system"></div>
        
        <div class="info-panel" id="info-panel">
            <h3 id="info-name"></h3>
            <div class="info-type" id="info-type"></div>
            <p class="info-description" id="info-description"></p>
            <div class="info-stats" id="info-stats"></div>
            <div class="info-facts" id="info-facts"></div>
            <a class="wiki-link" id="wiki-link" href="#" target="_blank">
                üìñ Read more on Wikipedia
            </a>
        </div>

        <div class="controls-hint">
            <kbd>Click + Drag</kbd> to rotate | 
            <kbd>Scroll</kbd> to zoom | 
            <kbd>Right Click + Drag</kbd> to pan
        </div>

        <div class="tour-progress" id="tour-progress">
            <span class="tour-progress-text" id="tour-object-name">Sun</span>
            <div class="tour-progress-bar">
                <div class="tour-progress-fill" id="tour-progress-fill"></div>
            </div>
            <span style="color: #888; font-size: 12px;" id="tour-counter">1 / 24</span>
        </div>
    </main>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // Planet data with moons
        const planetData = [
            { 
                name: 'Sun', radius: 5, distance: 0, color: 0xffff00, emissive: true, speed: 0, type: 'star', 
                description: 'The Sun is the star at the center of our Solar System. It is a nearly perfect ball of hot plasma that provides the energy necessary for life on Earth.',
                wiki: 'https://en.wikipedia.org/wiki/Sun',
                mass: '1.989 √ó 10¬≥‚Å∞ kg',
                diameter: '1,392,700 km',
                surfaceTemp: '5,500¬∞C',
                age: '4.6 billion years',
                composition: '73% Hydrogen, 25% Helium',
                facts: ['Contains 99.86% of the Solar System mass', 'Light takes 8 minutes to reach Earth', 'Core temperature is 15 million ¬∞C', 'Will become a red giant in 5 billion years']
            },
            { 
                name: 'Mercury', radius: 0.4, distance: 10, color: 0x8c7853, speed: 4.74, type: 'planet', 
                description: 'Mercury is the smallest planet and closest to the Sun. Despite being nearest to the Sun, it is not the hottest planet due to its lack of atmosphere.',
                wiki: 'https://en.wikipedia.org/wiki/Mercury_(planet)',
                mass: '3.285 √ó 10¬≤¬≥ kg',
                diameter: '4,879 km',
                dayLength: '59 Earth days',
                yearLength: '88 Earth days',
                numMoons: '0',
                surfaceTemp: '-180¬∞C to 430¬∞C',
                facts: ['Smallest planet in our solar system', 'Has no atmosphere to retain heat', 'Most cratered planet', 'Has ice in permanently shadowed craters']
            },
            { 
                name: 'Venus', radius: 0.9, distance: 15, color: 0xffc649, speed: 3.5, type: 'planet', 
                description: 'Venus is the hottest planet in our solar system due to its thick atmosphere that traps heat. It rotates backwards compared to most planets.',
                wiki: 'https://en.wikipedia.org/wiki/Venus',
                mass: '4.867 √ó 10¬≤‚Å¥ kg',
                diameter: '12,104 km',
                dayLength: '243 Earth days',
                yearLength: '225 Earth days',
                numMoons: '0',
                surfaceTemp: '465¬∞C',
                facts: ['Hottest planet in the solar system', 'Rotates backwards (retrograde)', 'A day is longer than a year', 'Atmospheric pressure 90x Earth']
            },
            { 
                name: 'Earth', radius: 1, distance: 20, color: 0x6b93d6, speed: 2.98, type: 'planet', 
                description: 'Earth is our home planet and the only known place in the universe where life exists. It has liquid water on its surface and a protective magnetic field.',
                wiki: 'https://en.wikipedia.org/wiki/Earth',
                mass: '5.972 √ó 10¬≤‚Å¥ kg',
                diameter: '12,742 km',
                dayLength: '24 hours',
                yearLength: '365.25 days',
                numMoons: '1',
                surfaceTemp: '-89¬∞C to 57¬∞C',
                facts: ['Only planet known to harbor life', '71% of surface is water', 'Has a magnetic field protecting from solar wind', 'Tilted 23.5¬∞ creating seasons'],
                moons: [
                    { name: 'Moon', radius: 0.27, distance: 2, color: 0xaaaaaa, speed: 8, description: 'The Moon is Earth\'s only natural satellite. It is the fifth largest moon in the Solar System.', wiki: 'https://en.wikipedia.org/wiki/Moon', diameter: '3,474 km', orbitalPeriod: '27.3 days', facts: ['Causes tides on Earth', 'Same side always faces Earth', '12 humans have walked on it'] }
                ]
            },
            { 
                name: 'Mars', radius: 0.5, distance: 25, color: 0xc1440e, speed: 2.41, type: 'planet', 
                description: 'Mars is known as the Red Planet due to iron oxide on its surface. It has the largest volcano and canyon system in the solar system.',
                wiki: 'https://en.wikipedia.org/wiki/Mars',
                mass: '6.39 √ó 10¬≤¬≥ kg',
                diameter: '6,779 km',
                dayLength: '24.6 hours',
                yearLength: '687 Earth days',
                numMoons: '2',
                surfaceTemp: '-140¬∞C to 20¬∞C',
                facts: ['Has the largest volcano: Olympus Mons', 'Valles Marineris is 4,000 km long', 'Has seasons like Earth', 'Multiple rovers have explored it'],
                moons: [
                    { name: 'Phobos', radius: 0.08, distance: 1.2, color: 0x8b7355, speed: 15, description: 'Phobos is the larger of Mars\' two moons. It orbits so close that it will eventually crash into Mars.', wiki: 'https://en.wikipedia.org/wiki/Phobos_(moon)', diameter: '22.4 km', orbitalPeriod: '7.7 hours', facts: ['Will crash into Mars in 50 million years', 'Orbits 3 times per Martian day'] },
                    { name: 'Deimos', radius: 0.05, distance: 1.8, color: 0x9b8b7a, speed: 10, description: 'Deimos is the smaller and outermost of Mars\' two moons. It is slowly spiraling away from Mars.', wiki: 'https://en.wikipedia.org/wiki/Deimos_(moon)', diameter: '12.4 km', orbitalPeriod: '30.3 hours', facts: ['Smallest known moon in solar system', 'Slowly moving away from Mars'] }
                ]
            },
            { 
                name: 'Jupiter', radius: 2.5, distance: 35, color: 0xd8ca9d, speed: 1.31, type: 'planet', 
                description: 'Jupiter is the largest planet in our solar system. Its Great Red Spot is a storm larger than Earth that has been raging for centuries.',
                wiki: 'https://en.wikipedia.org/wiki/Jupiter',
                mass: '1.898 √ó 10¬≤‚Å∑ kg',
                diameter: '139,820 km',
                dayLength: '9.9 hours',
                yearLength: '12 Earth years',
                numMoons: '95',
                surfaceTemp: '-145¬∞C (cloud tops)',
                facts: ['Largest planet in solar system', 'Great Red Spot is 1.3x Earth size', 'Has the strongest magnetic field', 'Could fit 1,300 Earths inside'],
                moons: [
                    { name: 'Io', radius: 0.28, distance: 4, color: 0xffff66, speed: 12, description: 'Io is the most volcanically active body in the Solar System, with over 400 active volcanoes.', wiki: 'https://en.wikipedia.org/wiki/Io_(moon)', diameter: '3,643 km', orbitalPeriod: '1.77 days', facts: ['Over 400 active volcanoes', 'Sulfur gives it yellow color', 'Tidally heated by Jupiter'] },
                    { name: 'Europa', radius: 0.25, distance: 4.8, color: 0xc9b896, speed: 9, description: 'Europa has a subsurface ocean that may contain more water than all of Earth\'s oceans combined.', wiki: 'https://en.wikipedia.org/wiki/Europa_(moon)', diameter: '3,122 km', orbitalPeriod: '3.55 days', facts: ['May have 2x Earth\'s water', 'Possible habitat for life', 'Ice shell is 15-25 km thick'] },
                    { name: 'Ganymede', radius: 0.41, distance: 5.8, color: 0x8b8682, speed: 6, description: 'Ganymede is the largest moon in the Solar System, even larger than the planet Mercury.', wiki: 'https://en.wikipedia.org/wiki/Ganymede_(moon)', diameter: '5,268 km', orbitalPeriod: '7.15 days', facts: ['Largest moon in solar system', 'Has its own magnetic field', 'Larger than Mercury'] },
                    { name: 'Callisto', radius: 0.38, distance: 7, color: 0x5c5346, speed: 4, description: 'Callisto is the most heavily cratered object in the Solar System and may have a subsurface ocean.', wiki: 'https://en.wikipedia.org/wiki/Callisto_(moon)', diameter: '4,821 km', orbitalPeriod: '16.7 days', facts: ['Most cratered object known', 'May have subsurface ocean', 'Ancient, unchanged surface'] }
                ]
            },
            { 
                name: 'Saturn', radius: 2.2, distance: 45, color: 0xead6b8, speed: 0.97, hasRings: true, type: 'planet', 
                description: 'Saturn is famous for its stunning ring system, made mostly of ice particles with some rocky debris and dust.',
                wiki: 'https://en.wikipedia.org/wiki/Saturn',
                mass: '5.683 √ó 10¬≤‚Å∂ kg',
                diameter: '116,460 km',
                dayLength: '10.7 hours',
                yearLength: '29 Earth years',
                numMoons: '146',
                surfaceTemp: '-178¬∞C (cloud tops)',
                facts: ['Rings span 282,000 km', 'Less dense than water', 'Has 146 known moons', 'Winds reach 1,800 km/h'],
                moons: [
                    { name: 'Titan', radius: 0.4, distance: 5, color: 0xe8b86d, speed: 5, description: 'Titan is the only moon with a dense atmosphere and the only place besides Earth with surface lakes and seas.', wiki: 'https://en.wikipedia.org/wiki/Titan_(moon)', diameter: '5,150 km', orbitalPeriod: '16 days', facts: ['Has lakes of liquid methane', 'Dense nitrogen atmosphere', 'Larger than Mercury'] },
                    { name: 'Enceladus', radius: 0.15, distance: 3.5, color: 0xffffff, speed: 10, description: 'Enceladus has geysers that shoot water ice into space, suggesting a subsurface ocean.', wiki: 'https://en.wikipedia.org/wiki/Enceladus', diameter: '504 km', orbitalPeriod: '1.4 days', facts: ['Geysers shoot ice into space', 'Has hydrothermal vents', 'Top candidate for life'] },
                    { name: 'Mimas', radius: 0.1, distance: 3, color: 0xcccccc, speed: 14, description: 'Mimas has a giant crater that makes it look like the Death Star from Star Wars.', wiki: 'https://en.wikipedia.org/wiki/Mimas_(moon)', diameter: '396 km', orbitalPeriod: '22.6 hours', facts: ['Looks like the Death Star', 'Herschel crater is 130 km wide', 'Smallest spherical moon'] }
                ]
            },
            { 
                name: 'Uranus', radius: 1.5, distance: 55, color: 0xd1e7e7, speed: 0.68, type: 'planet', 
                description: 'Uranus rotates on its side at a 98¬∞ tilt, making it unique among the planets. Its blue-green color comes from methane in its atmosphere.',
                wiki: 'https://en.wikipedia.org/wiki/Uranus',
                mass: '8.681 √ó 10¬≤‚Åµ kg',
                diameter: '50,724 km',
                dayLength: '17.2 hours',
                yearLength: '84 Earth years',
                numMoons: '28',
                surfaceTemp: '-224¬∞C',
                facts: ['Rotates on its side (98¬∞ tilt)', 'Coldest planetary atmosphere', 'Has 13 known rings', 'First planet discovered by telescope'],
                moons: [
                    { name: 'Titania', radius: 0.12, distance: 3, color: 0xaabbcc, speed: 7, description: 'Titania is the largest moon of Uranus and has canyons and scarps on its surface.', wiki: 'https://en.wikipedia.org/wiki/Titania_(moon)', diameter: '1,578 km', orbitalPeriod: '8.7 days', facts: ['Largest moon of Uranus', 'Has enormous canyons', 'May have subsurface ocean'] },
                    { name: 'Oberon', radius: 0.12, distance: 3.8, color: 0x998877, speed: 5, description: 'Oberon is the second largest moon of Uranus, with a heavily cratered and ancient surface.', wiki: 'https://en.wikipedia.org/wiki/Oberon_(moon)', diameter: '1,523 km', orbitalPeriod: '13.5 days', facts: ['Second largest Uranian moon', 'Very heavily cratered', 'Has a large mountain'] }
                ]
            },
            { 
                name: 'Neptune', radius: 1.4, distance: 65, color: 0x5b5ddf, speed: 0.54, type: 'planet', 
                description: 'Neptune is the windiest planet, with winds reaching speeds of 2,100 km/h. It was the first planet found by mathematical prediction.',
                wiki: 'https://en.wikipedia.org/wiki/Neptune',
                mass: '1.024 √ó 10¬≤‚Å∂ kg',
                diameter: '49,244 km',
                dayLength: '16 hours',
                yearLength: '165 Earth years',
                numMoons: '16',
                surfaceTemp: '-218¬∞C',
                facts: ['Strongest winds in solar system', 'Found by math before observation', 'Has 5 main rings', 'Great Dark Spot was Earth-sized'],
                moons: [
                    { name: 'Triton', radius: 0.21, distance: 3.5, color: 0xd4c4b0, speed: 6, description: 'Triton orbits Neptune backwards and is slowly spiraling inward. It has geysers of nitrogen gas.', wiki: 'https://en.wikipedia.org/wiki/Triton_(moon)', diameter: '2,707 km', orbitalPeriod: '5.9 days (retrograde)', facts: ['Orbits backwards', 'Has nitrogen geysers', 'Will be destroyed in 3.6 billion years'] }
                ]
            }
        ];

        // Dwarf planets data
        const dwarfPlanetData = [
            { 
                name: 'Ceres', radius: 0.3, distance: 30, color: 0x8b8378, speed: 1.8, type: 'dwarf', 
                description: 'Ceres is the largest object in the asteroid belt and the only dwarf planet located in the inner solar system.',
                wiki: 'https://en.wikipedia.org/wiki/Ceres_(dwarf_planet)',
                mass: '9.39 √ó 10¬≤‚Å∞ kg',
                diameter: '940 km',
                dayLength: '9 hours',
                yearLength: '4.6 Earth years',
                discoveredBy: 'Giuseppe Piazzi (1801)',
                facts: ['Largest object in asteroid belt', 'Has subsurface ocean', 'Bright spots are salt deposits', 'Visited by Dawn spacecraft'],
                moons: [] 
            },
            { 
                name: 'Pluto', radius: 0.35, distance: 75, color: 0xddccbb, speed: 0.47, type: 'dwarf', 
                description: 'Pluto was considered the ninth planet until 2006. It has a heart-shaped nitrogen ice glacier called Tombaugh Regio.',
                wiki: 'https://en.wikipedia.org/wiki/Pluto',
                mass: '1.31 √ó 10¬≤¬≤ kg',
                diameter: '2,377 km',
                dayLength: '6.4 Earth days',
                yearLength: '248 Earth years',
                numMoons: '5',
                discoveredBy: 'Clyde Tombaugh (1930)',
                facts: ['Has 5 moons', 'Heart-shaped glacier', 'Has blue skies and red snow', 'Smaller than Earth\'s Moon'],
                moons: [
                    { name: 'Charon', radius: 0.18, distance: 1.5, color: 0x888888, speed: 8, description: 'Charon is so large relative to Pluto that they orbit a common center of gravity between them.', wiki: 'https://en.wikipedia.org/wiki/Charon_(moon)', diameter: '1,212 km', orbitalPeriod: '6.4 days', facts: ['Half the size of Pluto', 'Tidally locked to Pluto', 'May have had subsurface ocean'] }
                ]
            },
            { 
                name: 'Haumea', radius: 0.25, distance: 82, color: 0xeeeeee, speed: 0.35, type: 'dwarf', 
                description: 'Haumea has an extremely elongated shape due to its incredibly rapid rotation, completing a day in just 4 hours.',
                wiki: 'https://en.wikipedia.org/wiki/Haumea',
                mass: '4.01 √ó 10¬≤¬π kg',
                diameter: '1,632 km (longest axis)',
                dayLength: '3.9 hours',
                yearLength: '284 Earth years',
                numMoons: '2',
                discoveredBy: 'Brown, Rabinowitz, Trujillo (2004)',
                facts: ['Fastest rotating dwarf planet', 'Has two small moons', 'Shaped like an ellipsoid', 'Has a ring system'],
                moons: [] 
            },
            { 
                name: 'Makemake', radius: 0.25, distance: 88, color: 0xcc9966, speed: 0.3, type: 'dwarf', 
                description: 'Makemake is one of the brightest objects in the Kuiper Belt and was named after the creation god of the Rapa Nui people.',
                wiki: 'https://en.wikipedia.org/wiki/Makemake',
                mass: '3.1 √ó 10¬≤¬π kg',
                diameter: '1,430 km',
                dayLength: '22.5 hours',
                yearLength: '306 Earth years',
                numMoons: '1',
                discoveredBy: 'Michael Brown (2005)',
                facts: ['Second brightest Kuiper Belt object', 'Named after Easter Island god', 'Has one known moon', 'Extremely cold: -240¬∞C'],
                moons: [] 
            },
            { 
                name: 'Eris', radius: 0.36, distance: 95, color: 0xbbbbbb, speed: 0.25, type: 'dwarf', 
                description: 'Eris is the most massive known dwarf planet. Its discovery in 2005 led to the reclassification of Pluto.',
                wiki: 'https://en.wikipedia.org/wiki/Eris_(dwarf_planet)',
                mass: '1.66 √ó 10¬≤¬≤ kg',
                diameter: '2,326 km',
                dayLength: '25.9 hours',
                yearLength: '558 Earth years',
                numMoons: '1',
                discoveredBy: 'Michael Brown (2005)',
                facts: ['Most massive dwarf planet', 'Named after goddess of discord', 'Caused Pluto\'s reclassification', 'Three times farther than Pluto'],
                moons: [
                    { name: 'Dysnomia', radius: 0.1, distance: 1.5, color: 0x666666, speed: 6, description: 'Dysnomia is the only known moon of Eris, named after the daughter of the Greek goddess Eris.', wiki: 'https://en.wikipedia.org/wiki/Dysnomia_(moon)', diameter: '700 km', orbitalPeriod: '15.8 days', facts: ['Named after spirit of lawlessness', 'Used to measure Eris\'s mass'] }
                ]
            }
        ];

        // Named asteroids data
        const asteroidData = [
            { 
                name: 'Vesta', radius: 0.18, distance: 28, color: 0x9a9a8a, speed: 1.9, type: 'asteroid', orbitTilt: 0.1, 
                description: 'Vesta is the second-largest asteroid in the asteroid belt and was visited by NASA\'s Dawn spacecraft.',
                wiki: 'https://en.wikipedia.org/wiki/4_Vesta',
                diameter: '525 km',
                mass: '2.59 √ó 10¬≤‚Å∞ kg',
                discoveredBy: 'Heinrich Olbers (1807)',
                facts: ['Second largest asteroid', 'Has a giant south pole crater', 'Visited by Dawn spacecraft', 'Source of HED meteorites']
            },
            { 
                name: 'Pallas', radius: 0.17, distance: 29, color: 0x7a7a6a, speed: 1.85, type: 'asteroid', orbitTilt: 0.6, 
                description: 'Pallas has one of the most inclined orbits of any asteroid, tilted 34.8¬∞ to the ecliptic.',
                wiki: 'https://en.wikipedia.org/wiki/2_Pallas',
                diameter: '512 km',
                mass: '2.04 √ó 10¬≤‚Å∞ kg',
                discoveredBy: 'Heinrich Olbers (1802)',
                facts: ['Third largest asteroid', 'Highly inclined orbit', 'Never been visited by spacecraft', 'Named after Athena Pallas']
            },
            { 
                name: 'Hygiea', radius: 0.14, distance: 31, color: 0x5a5a4a, speed: 1.75, type: 'asteroid', orbitTilt: 0.08, 
                description: 'Hygiea may be reclassified as a dwarf planet due to its nearly spherical shape.',
                wiki: 'https://en.wikipedia.org/wiki/10_Hygiea',
                diameter: '434 km',
                mass: '8.7 √ó 10¬π‚Åπ kg',
                discoveredBy: 'Annibale de Gasparis (1849)',
                facts: ['Fourth largest asteroid', 'Nearly spherical shape', 'May be a dwarf planet', 'Named after goddess of health']
            },
            { 
                name: 'Interamnia', radius: 0.11, distance: 32, color: 0x6b6b5b, speed: 1.7, type: 'asteroid', orbitTilt: 0.3, 
                description: 'Interamnia is one of the largest asteroids in the main belt, with a diameter of about 330 km.',
                wiki: 'https://en.wikipedia.org/wiki/704_Interamnia',
                diameter: '332 km',
                mass: '3.9 √ó 10¬π‚Åπ kg',
                discoveredBy: 'Vincenzo Cerulli (1910)',
                facts: ['Fifth largest asteroid', 'F-type asteroid', 'Named after Latin name for Teramo', 'Very dark surface']
            },
            { 
                name: 'Europa (Asteroid)', radius: 0.1, distance: 33, color: 0x8b8b7b, speed: 1.65, type: 'asteroid', orbitTilt: 0.12, 
                description: 'Asteroid 52 Europa is not to be confused with Jupiter\'s moon. It\'s a large C-type asteroid.',
                wiki: 'https://en.wikipedia.org/wiki/52_Europa',
                diameter: '303 km',
                mass: '2.4 √ó 10¬π‚Åπ kg',
                discoveredBy: 'Hermann Goldschmidt (1858)',
                facts: ['Sixth largest asteroid', 'C-type (carbonaceous)', 'Named after mythological Europa', 'Has irregular shape']
            },
            { 
                name: 'Davida', radius: 0.1, distance: 34, color: 0x7c7c6c, speed: 1.6, type: 'asteroid', orbitTilt: 0.26, 
                description: 'Davida is one of the largest main-belt asteroids, discovered in 1903.',
                wiki: 'https://en.wikipedia.org/wiki/511_Davida',
                diameter: '289 km',
                mass: '3.6 √ó 10¬π‚Åπ kg',
                discoveredBy: 'Raymond Dugan (1903)',
                facts: ['Seventh largest asteroid', 'C-type asteroid', 'Named after David P. Todd', 'Very low density']
            },
            { 
                name: 'Eros', radius: 0.06, distance: 17, color: 0xaa9988, speed: 2.8, type: 'asteroid', orbitTilt: 0.18, 
                description: 'Eros was the first asteroid to be orbited and landed on by a spacecraft.',
                wiki: 'https://en.wikipedia.org/wiki/433_Eros',
                diameter: '16.8 km',
                mass: '6.69 √ó 10¬π‚Åµ kg',
                discoveredBy: 'Carl Witt (1898)',
                facts: ['First near-Earth asteroid discovered', 'NEAR Shoemaker landed on it', 'Peanut-shaped', 'Named after god of love']
            },
            { 
                name: 'Bennu', radius: 0.03, distance: 18, color: 0x555544, speed: 2.6, type: 'asteroid', orbitTilt: 0.1, 
                description: 'Bennu is a near-Earth asteroid from which OSIRIS-REx collected and returned samples to Earth in 2023.',
                wiki: 'https://en.wikipedia.org/wiki/101955_Bennu',
                diameter: '490 m',
                mass: '7.3 √ó 10¬π‚Å∞ kg',
                discoveredBy: 'LINEAR (1999)',
                facts: ['Samples returned to Earth', 'Rubble pile asteroid', 'Potentially hazardous', 'Named via student contest']
            },
            { 
                name: 'Apophis', radius: 0.04, distance: 19, color: 0x666655, speed: 2.5, type: 'asteroid', orbitTilt: 0.05, 
                description: 'Apophis will pass extremely close to Earth on April 13, 2029, visible to the naked eye.',
                wiki: 'https://en.wikipedia.org/wiki/99942_Apophis',
                diameter: '370 m',
                mass: '2.7 √ó 10¬π‚Å∞ kg',
                discoveredBy: 'R. Tucker, D. Tholen, F. Bernardi (2004)',
                facts: ['Will pass within 31,000 km in 2029', 'Named after Egyptian god of chaos', 'Visible to naked eye in 2029', 'No impact risk for 100+ years']
            },
            { 
                name: 'Itokawa', radius: 0.02, distance: 21, color: 0x998877, speed: 2.4, type: 'asteroid', orbitTilt: 0.03, 
                description: 'Itokawa is a peanut-shaped near-Earth asteroid visited by Japan\'s Hayabusa spacecraft.',
                wiki: 'https://en.wikipedia.org/wiki/25143_Itokawa',
                diameter: '535 m',
                mass: '3.5 √ó 10¬π‚Å∞ kg',
                discoveredBy: 'LINEAR (1998)',
                facts: ['First asteroid sample return', 'Rubble pile structure', 'Named after Hideo Itokawa', 'Hayabusa returned samples']
            }
        ];

        // Comets data - with elliptical orbits
        const cometData = [
            { 
                name: 'Halley\'s Comet', radius: 0.15, perihelion: 9, aphelion: 70, color: 0xaaddff, speed: 0.8, type: 'comet', orbitTilt: 0.3, tailLength: 8, 
                description: 'Halley\'s Comet is the most famous periodic comet, visible from Earth every 75-79 years.',
                wiki: 'https://en.wikipedia.org/wiki/Halley%27s_Comet',
                orbitalPeriod: '75-79 years',
                lastPerihelion: '1986',
                nextPerihelion: '2061',
                nucleus: '15 √ó 8 km',
                discoveredBy: 'Edmond Halley (predicted 1705)',
                facts: ['Observed since 240 BCE', 'Returns in 2061', 'Nucleus is potato-shaped', 'Source of two meteor showers']
            },
            { 
                name: 'Hale-Bopp', radius: 0.2, perihelion: 12, aphelion: 85, color: 0xccffff, speed: 0.4, type: 'comet', orbitTilt: -0.5, tailLength: 10, 
                description: 'Comet Hale-Bopp was one of the most widely observed comets of the 20th century.',
                wiki: 'https://en.wikipedia.org/wiki/Comet_Hale%E2%80%93Bopp',
                orbitalPeriod: '2,533 years',
                lastPerihelion: '1997',
                nextPerihelion: '~4530',
                nucleus: '40-80 km',
                discoveredBy: 'Alan Hale & Thomas Bopp (1995)',
                facts: ['Visible for 18 months', 'One of the brightest ever seen', 'Has two distinct tails', 'Next return in ~4530']
            },
            { 
                name: 'Encke', radius: 0.08, perihelion: 8, aphelion: 35, color: 0x88ccff, speed: 1.5, type: 'comet', orbitTilt: 0.2, tailLength: 4, 
                description: 'Comet Encke has the shortest orbital period of any known comet at just 3.3 years.',
                wiki: 'https://en.wikipedia.org/wiki/Comet_Encke',
                orbitalPeriod: '3.3 years',
                lastPerihelion: '2023',
                nextPerihelion: '2027',
                nucleus: '4.8 km',
                discoveredBy: 'Pierre M√©chain (1786)',
                facts: ['Shortest orbital period', 'Source of Taurid meteors', 'Losing mass rapidly', 'Observed 63+ times']
            },
            { 
                name: 'Tempel 1', radius: 0.1, perihelion: 15, aphelion: 45, color: 0x99bbff, speed: 1.0, type: 'comet', orbitTilt: -0.18, tailLength: 5, 
                description: 'Comet Tempel 1 was the target of NASA\'s Deep Impact mission which crashed an impactor into it.',
                wiki: 'https://en.wikipedia.org/wiki/9P/Tempel',
                orbitalPeriod: '5.5 years',
                lastPerihelion: '2022',
                nextPerihelion: '2028',
                nucleus: '7.6 √ó 4.9 km',
                discoveredBy: 'Ernst Tempel (1867)',
                facts: ['Deep Impact target', 'Impactor hit at 10 km/s', 'Stardust-NExT flew by', 'Water ice confirmed']
            },
            { 
                name: 'Churyumov-Gerasimenko', radius: 0.08, perihelion: 14, aphelion: 50, color: 0xaabbdd, speed: 0.9, type: 'comet', orbitTilt: 0.12, tailLength: 4, 
                description: '67P/Churyumov-Gerasimenko was studied in detail by ESA\'s Rosetta mission.',
                wiki: 'https://en.wikipedia.org/wiki/67P/Churyumov%E2%80%93Gerasimenko',
                orbitalPeriod: '6.4 years',
                lastPerihelion: '2021',
                nextPerihelion: '2028',
                nucleus: '4.3 √ó 4.1 km',
                discoveredBy: 'Klim Churyumov (1969)',
                facts: ['Rosetta orbited for 2 years', 'Philae lander touched down', 'Rubber duck shape', 'Organic molecules found']
            },
            { 
                name: 'NEOWISE', radius: 0.12, perihelion: 7, aphelion: 90, color: 0xffffff, speed: 0.5, type: 'comet', orbitTilt: -0.4, tailLength: 7, 
                description: 'Comet NEOWISE was discovered in 2020 and became one of the brightest comets in decades.',
                wiki: 'https://en.wikipedia.org/wiki/Comet_NEOWISE',
                orbitalPeriod: '~6,800 years',
                lastPerihelion: '2020',
                nextPerihelion: '~8800',
                nucleus: '5 km',
                discoveredBy: 'NEOWISE telescope (2020)',
                facts: ['Brightest since Hale-Bopp', 'Visible to naked eye', 'Long orbital period', 'Survived close Sun approach']
            },
            { 
                name: 'Wild 2', radius: 0.07, perihelion: 16, aphelion: 42, color: 0x88aacc, speed: 1.1, type: 'comet', orbitTilt: 0.06, tailLength: 3, 
                description: 'Comet Wild 2 was visited by NASA\'s Stardust mission, which returned samples to Earth.',
                wiki: 'https://en.wikipedia.org/wiki/81P/Wild',
                orbitalPeriod: '6.4 years',
                lastPerihelion: '2022',
                nextPerihelion: '2029',
                nucleus: '5.5 √ó 4.0 km',
                discoveredBy: 'Paul Wild (1978)',
                facts: ['Stardust collected samples', 'Samples returned 2006', 'Amino acids found', 'Jupiter encounter changed orbit']
            }
        ];

        // Combine all celestial bodies
        const allBodies = [...planetData, ...dwarfPlanetData];

        // Scene setup
        const container = document.getElementById('solar-system');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // Controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 10;
        controls.maxDistance = 200;

        // Camera position
        camera.position.set(80, 60, 80);
        controls.maxDistance = 400;
        controls.update();

        // Starfield background
        function createStarfield() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.5 });
            
            const starsVertices = [];
            for (let i = 0; i < 10000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starsVertices.push(x, y, z);
            }
            
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            return new THREE.Points(starsGeometry, starsMaterial);
        }
        const starfield = createStarfield();
        scene.add(starfield);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x222222);
        scene.add(ambientLight);

        const sunLight = new THREE.PointLight(0xffffff, 2, 500);
        sunLight.castShadow = true;
        sunLight.shadow.mapSize.width = 2048;
        sunLight.shadow.mapSize.height = 2048;
        sunLight.shadow.camera.near = 0.5;
        sunLight.shadow.camera.far = 500;
        sunLight.shadow.bias = -0.001;
        scene.add(sunLight);

        // Solar system group for vortex mode
        const solarSystemGroup = new THREE.Group();
        scene.add(solarSystemGroup);

        // Create planets, moons and orbits
        const planets = [];
        const orbits = [];
        const labels = [];
        const moons = [];

        allBodies.forEach((data, index) => {
            // Create planet
            const geometry = new THREE.SphereGeometry(data.radius, 32, 32);
            let material;
            
            if (data.emissive) {
                material = new THREE.MeshBasicMaterial({ color: data.color });
            } else {
                material = new THREE.MeshStandardMaterial({ 
                    color: data.color,
                    roughness: 0.8,
                    metalness: 0.2
                });
            }
            
            const planet = new THREE.Mesh(geometry, material);
            
            // Enable shadows for planets (not the sun)
            if (!data.emissive) {
                planet.castShadow = true;
                planet.receiveShadow = true;
            }
            
            // Create orbit group
            const orbitGroup = new THREE.Group();
            orbitGroup.add(planet);
            planet.position.x = data.distance;
            
            // Add rings for Saturn
            if (data.hasRings) {
                const ringGeometry = new THREE.RingGeometry(data.radius * 1.4, data.radius * 2.2, 64);
                const ringMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0xc9b896, 
                    side: THREE.DoubleSide,
                    transparent: true,
                    opacity: 0.7,
                    roughness: 0.8,
                    metalness: 0.1
                });
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.rotation.x = Math.PI / 2;
                ring.castShadow = true;
                ring.receiveShadow = true;
                planet.add(ring);
            }

            // Create moons for this planet
            const planetMoons = [];
            if (data.moons && data.moons.length > 0) {
                data.moons.forEach((moonData) => {
                    const moonGeometry = new THREE.SphereGeometry(moonData.radius, 16, 16);
                    const moonMaterial = new THREE.MeshStandardMaterial({
                        color: moonData.color,
                        roughness: 0.9,
                        metalness: 0.1
                    });
                    const moon = new THREE.Mesh(moonGeometry, moonMaterial);
                    moon.castShadow = true;
                    moon.receiveShadow = true;
                    
                    // Moon orbit group (attached to planet)
                    const moonOrbitGroup = new THREE.Group();
                    moonOrbitGroup.add(moon);
                    moon.position.x = moonData.distance;
                    planet.add(moonOrbitGroup);
                    
                    // Moon orbit line
                    const moonOrbitGeometry = new THREE.BufferGeometry();
                    const moonOrbitPoints = [];
                    for (let i = 0; i <= 32; i++) {
                        const angle = (i / 32) * Math.PI * 2;
                        moonOrbitPoints.push(
                            Math.cos(angle) * moonData.distance,
                            0,
                            Math.sin(angle) * moonData.distance
                        );
                    }
                    moonOrbitGeometry.setAttribute('position', new THREE.Float32BufferAttribute(moonOrbitPoints, 3));
                    const moonOrbitMaterial = new THREE.LineBasicMaterial({ color: 0x333355, transparent: true, opacity: 0.3 });
                    const moonOrbitLine = new THREE.Line(moonOrbitGeometry, moonOrbitMaterial);
                    planet.add(moonOrbitLine);
                    orbits.push(moonOrbitLine);
                    
                    // Moon label
                    const moonLabelDiv = document.createElement('div');
                    moonLabelDiv.className = 'moon-label';
                    moonLabelDiv.textContent = moonData.name;
                    moonLabelDiv.style.cssText = `
                        position: absolute;
                        color: #aaaaff;
                        font-size: 10px;
                        pointer-events: none;
                        text-shadow: 0 0 3px black;
                        opacity: 0.7;
                    `;
                    container.appendChild(moonLabelDiv);
                    
                    const moonObj = {
                        mesh: moon,
                        orbitGroup: moonOrbitGroup,
                        data: moonData,
                        angle: Math.random() * Math.PI * 2,
                        label: moonLabelDiv,
                        parentPlanet: planet
                    };
                    planetMoons.push(moonObj);
                    moons.push(moonObj);
                });
            }
            
            solarSystemGroup.add(orbitGroup);
            
            // Create orbit line
            let orbitLine = null;
            if (data.distance > 0) {
                const orbitGeometry = new THREE.BufferGeometry();
                const orbitPoints = [];
                for (let i = 0; i <= 64; i++) {
                    const angle = (i / 64) * Math.PI * 2;
                    orbitPoints.push(
                        Math.cos(angle) * data.distance,
                        0,
                        Math.sin(angle) * data.distance
                    );
                }
                orbitGeometry.setAttribute('position', new THREE.Float32BufferAttribute(orbitPoints, 3));
                // Different colors for planets vs dwarf planets
                const orbitColor = data.type === 'dwarf' ? 0x553333 : 0x444444;
                const orbitMaterial = new THREE.LineBasicMaterial({ color: orbitColor, transparent: true, opacity: 0.5 });
                orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
                solarSystemGroup.add(orbitLine);
                orbits.push(orbitLine);
            }
            
            planets.push({
                mesh: planet,
                orbitGroup: orbitGroup,
                orbitLine: orbitLine,
                data: data,
                angle: Math.random() * Math.PI * 2,
                moons: planetMoons
            });

            // Create label
            const labelDiv = document.createElement('div');
            labelDiv.className = 'planet-label';
            labelDiv.textContent = data.name;
            const labelColor = data.type === 'dwarf' ? '#ff9999' : 'white';
            labelDiv.style.cssText = `
                position: absolute;
                color: ${labelColor};
                font-size: 12px;
                pointer-events: none;
                text-shadow: 0 0 5px black;
                opacity: 0.8;
            `;
            container.appendChild(labelDiv);
            labels.push(labelDiv);
        });

        // Add sun glow effect
        const sunGlowGeometry = new THREE.SphereGeometry(6.5, 32, 32);
        const sunGlowMaterial = new THREE.MeshBasicMaterial({
            color: 0xffaa00,
            transparent: true,
            opacity: 0.3,
            side: THREE.BackSide
        });
        const sunGlow = new THREE.Mesh(sunGlowGeometry, sunGlowMaterial);
        solarSystemGroup.add(sunGlow);
        
        // Outer glow
        const sunOuterGlowGeometry = new THREE.SphereGeometry(8, 32, 32);
        const sunOuterGlowMaterial = new THREE.MeshBasicMaterial({
            color: 0xff6600,
            transparent: true,
            opacity: 0.15,
            side: THREE.BackSide
        });
        const sunOuterGlow = new THREE.Mesh(sunOuterGlowGeometry, sunOuterGlowMaterial);
        solarSystemGroup.add(sunOuterGlow);

        // Create asteroids
        const asteroids = [];
        asteroidData.forEach((data) => {
            const geometry = new THREE.IcosahedronGeometry(data.radius, 0); // Irregular shape
            const material = new THREE.MeshStandardMaterial({
                color: data.color,
                roughness: 1.0,
                metalness: 0.3
            });
            const asteroid = new THREE.Mesh(geometry, material);
            asteroid.castShadow = true;
            asteroid.receiveShadow = true;
            
            const orbitGroup = new THREE.Group();
            orbitGroup.rotation.x = data.orbitTilt || 0;
            orbitGroup.add(asteroid);
            asteroid.position.x = data.distance;
            
            // Random rotation for irregular look
            asteroid.rotation.set(
                Math.random() * Math.PI,
                Math.random() * Math.PI,
                Math.random() * Math.PI
            );
            
            solarSystemGroup.add(orbitGroup);
            
            // Create orbit line
            const orbitGeometry = new THREE.BufferGeometry();
            const orbitPoints = [];
            for (let i = 0; i <= 64; i++) {
                const angle = (i / 64) * Math.PI * 2;
                orbitPoints.push(
                    Math.cos(angle) * data.distance,
                    0,
                    Math.sin(angle) * data.distance
                );
            }
            orbitGeometry.setAttribute('position', new THREE.Float32BufferAttribute(orbitPoints, 3));
            const orbitMaterial = new THREE.LineBasicMaterial({ color: 0x335533, transparent: true, opacity: 0.3 });
            const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
            orbitLine.rotation.x = data.orbitTilt || 0;
            solarSystemGroup.add(orbitLine);
            
            // Create label
            const labelDiv = document.createElement('div');
            labelDiv.className = 'asteroid-label';
            labelDiv.textContent = data.name;
            labelDiv.style.cssText = `
                position: absolute;
                color: #99ff99;
                font-size: 10px;
                pointer-events: none;
                text-shadow: 0 0 3px black;
                opacity: 0.7;
            `;
            container.appendChild(labelDiv);
            
            asteroids.push({
                mesh: asteroid,
                orbitGroup: orbitGroup,
                orbitLine: orbitLine,
                data: data,
                angle: Math.random() * Math.PI * 2,
                label: labelDiv
            });
        });

        // Create comets with tails
        const comets = [];
        cometData.forEach((data) => {
            // Comet nucleus
            const geometry = new THREE.SphereGeometry(data.radius, 16, 16);
            const material = new THREE.MeshStandardMaterial({
                color: data.color,
                roughness: 0.9,
                metalness: 0.1
            });
            const comet = new THREE.Mesh(geometry, material);
            comet.castShadow = true;
            comet.receiveShadow = true;
            
            const orbitGroup = new THREE.Group();
            orbitGroup.rotation.x = data.orbitTilt || 0;
            orbitGroup.add(comet);
            
            // Start at random position in elliptical orbit
            const startAngle = Math.random() * Math.PI * 2;
            const semiMajorAxis = (data.perihelion + data.aphelion) / 2;
            const eccentricity = (data.aphelion - data.perihelion) / (data.aphelion + data.perihelion);
            
            solarSystemGroup.add(orbitGroup);
            
            // Create elliptical orbit line
            const orbitGeometry = new THREE.BufferGeometry();
            const orbitPoints = [];
            for (let i = 0; i <= 128; i++) {
                const angle = (i / 128) * Math.PI * 2;
                const r = semiMajorAxis * (1 - eccentricity * eccentricity) / (1 + eccentricity * Math.cos(angle));
                orbitPoints.push(
                    Math.cos(angle) * r,
                    0,
                    Math.sin(angle) * r
                );
            }
            orbitGeometry.setAttribute('position', new THREE.Float32BufferAttribute(orbitPoints, 3));
            const orbitMaterial = new THREE.LineBasicMaterial({ color: 0x4466aa, transparent: true, opacity: 0.4 });
            const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
            orbitLine.rotation.x = data.orbitTilt || 0;
            solarSystemGroup.add(orbitLine);
            
            // Create label
            const labelDiv = document.createElement('div');
            labelDiv.className = 'comet-label';
            labelDiv.textContent = data.name;
            labelDiv.style.cssText = `
                position: absolute;
                color: #aaddff;
                font-size: 10px;
                pointer-events: none;
                text-shadow: 0 0 5px #0066ff;
                opacity: 0.9;
            `;
            container.appendChild(labelDiv);
            
            comets.push({
                mesh: comet,
                orbitGroup: orbitGroup,
                orbitLine: orbitLine,
                data: data,
                angle: startAngle,
                label: labelDiv,
                semiMajorAxis: semiMajorAxis,
                eccentricity: eccentricity
            });
        });

        // Populate sidebar
        const planetList = document.getElementById('planet-list');
        
        // Add planets section
        const planetsHeader = document.createElement('li');
        planetsHeader.innerHTML = '<div style="color: #666; font-size: 11px; padding: 8px 0; text-transform: uppercase; letter-spacing: 1px;">Planets</div>';
        planetList.appendChild(planetsHeader);
        
        allBodies.filter(d => d.type !== 'dwarf').forEach((data, index) => {
            const li = document.createElement('li');
            li.className = 'planet-item';
            li.innerHTML = `
                <div class="planet-color" style="background-color: #${data.color.toString(16).padStart(6, '0')}; color: #${data.color.toString(16).padStart(6, '0')};"></div>
                <div class="planet-info">
                    <div class="planet-name">${data.name}</div>
                    <div class="planet-distance">${data.distance > 0 ? data.distance + ' AU (scaled)' : 'Center'}</div>
                </div>
            `;
            li.addEventListener('click', () => focusOnPlanet(index));
            planetList.appendChild(li);
            
            // Add moons as sub-items
            if (data.moons && data.moons.length > 0) {
                data.moons.forEach((moon) => {
                    const moonLi = document.createElement('li');
                    moonLi.className = 'planet-item';
                    moonLi.style.cssText = 'padding-left: 35px; background: rgba(100, 100, 200, 0.05);';
                    moonLi.innerHTML = `
                        <div class="planet-color" style="width: 12px; height: 12px; background-color: #${moon.color.toString(16).padStart(6, '0')}; color: #${moon.color.toString(16).padStart(6, '0')};"></div>
                        <div class="planet-info">
                            <div class="planet-name" style="font-size: 12px; color: #aaa;">‚Ü≥ ${moon.name}</div>
                        </div>
                    `;
                    moonLi.addEventListener('click', () => {
                        // Focus on parent planet when clicking moon
                        focusOnPlanet(index);
                        document.getElementById('info-name').textContent = moon.name;
                        document.getElementById('info-description').textContent = moon.description;
                    });
                    planetList.appendChild(moonLi);
                });
            }
        });
        
        // Add dwarf planets section
        const dwarfHeader = document.createElement('li');
        dwarfHeader.innerHTML = '<div style="color: #996666; font-size: 11px; padding: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px; border-top: 1px solid #333;">Dwarf Planets</div>';
        planetList.appendChild(dwarfHeader);
        
        allBodies.filter(d => d.type === 'dwarf').forEach((data) => {
            const actualIndex = allBodies.findIndex(b => b.name === data.name);
            const li = document.createElement('li');
            li.className = 'planet-item';
            li.innerHTML = `
                <div class="planet-color" style="background-color: #${data.color.toString(16).padStart(6, '0')}; color: #${data.color.toString(16).padStart(6, '0')};"></div>
                <div class="planet-info">
                    <div class="planet-name" style="color: #ffaaaa;">${data.name}</div>
                    <div class="planet-distance">${data.distance} AU (scaled)</div>
                </div>
            `;
            li.addEventListener('click', () => focusOnPlanet(actualIndex));
            planetList.appendChild(li);
            
            // Add moons as sub-items
            if (data.moons && data.moons.length > 0) {
                data.moons.forEach((moon) => {
                    const moonLi = document.createElement('li');
                    moonLi.className = 'planet-item';
                    moonLi.style.cssText = 'padding-left: 35px; background: rgba(150, 100, 100, 0.05);';
                    moonLi.innerHTML = `
                        <div class="planet-color" style="width: 12px; height: 12px; background-color: #${moon.color.toString(16).padStart(6, '0')}; color: #${moon.color.toString(16).padStart(6, '0')};"></div>
                        <div class="planet-info">
                            <div class="planet-name" style="font-size: 12px; color: #aa8888;">‚Ü≥ ${moon.name}</div>
                        </div>
                    `;
                    moonLi.addEventListener('click', () => {
                        focusOnPlanet(actualIndex);
                        document.getElementById('info-name').textContent = moon.name;
                        document.getElementById('info-description').textContent = moon.description;
                    });
                    planetList.appendChild(moonLi);
                });
            }
        });

        // Add asteroids section
        const asteroidsHeader = document.createElement('li');
        asteroidsHeader.innerHTML = '<div style="color: #669966; font-size: 11px; padding: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px; border-top: 1px solid #333;">‚òÑ Asteroids</div>';
        planetList.appendChild(asteroidsHeader);
        
        asteroidData.forEach((data, index) => {
            const li = document.createElement('li');
            li.className = 'planet-item';
            li.innerHTML = `
                <div class="planet-color" style="width: 14px; height: 14px; background-color: #${data.color.toString(16).padStart(6, '0')}; border-radius: 3px;"></div>
                <div class="planet-info">
                    <div class="planet-name" style="color: #99ff99; font-size: 12px;">${data.name}</div>
                    <div class="planet-distance">${data.distance} AU</div>
                </div>
            `;
            li.addEventListener('click', () => focusOnAsteroid(index));
            planetList.appendChild(li);
        });

        // Add comets section
        const cometsHeader = document.createElement('li');
        cometsHeader.innerHTML = '<div style="color: #6699cc; font-size: 11px; padding: 15px 0 8px 0; text-transform: uppercase; letter-spacing: 1px; border-top: 1px solid #333;">‚òÑ Comets</div>';
        planetList.appendChild(cometsHeader);
        
        cometData.forEach((data, index) => {
            const li = document.createElement('li');
            li.className = 'planet-item';
            li.innerHTML = `
                <div class="planet-color" style="width: 14px; height: 14px; background: linear-gradient(135deg, #${data.color.toString(16).padStart(6, '0')}, transparent); border-radius: 50%;"></div>
                <div class="planet-info">
                    <div class="planet-name" style="color: #aaddff; font-size: 12px;">${data.name}</div>
                    <div class="planet-distance">${data.perihelion}-${data.aphelion} AU orbit</div>
                </div>
            `;
            li.addEventListener('click', () => focusOnComet(index));
            planetList.appendChild(li);
        });

        // Helper function to populate the info panel
        function populateInfoPanel(data) {
            const infoPanel = document.getElementById('info-panel');
            document.getElementById('info-name').textContent = data.name;
            
            // Type badge
            const typeLabels = {
                'star': '‚≠ê Star',
                'planet': 'ü™ê Planet',
                'dwarf': 'üîµ Dwarf Planet',
                'asteroid': '‚òÑÔ∏è Asteroid',
                'comet': 'üí´ Comet',
                'moon': 'üåô Moon'
            };
            document.getElementById('info-type').textContent = typeLabels[data.type] || data.type;
            
            document.getElementById('info-description').textContent = data.description;
            
            // Build stats grid
            const statsEl = document.getElementById('info-stats');
            let statsHtml = '';
            
            if (data.mass) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Mass</div><div class="stat-value">${data.mass}</div></div>`;
            }
            if (data.diameter) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Diameter</div><div class="stat-value">${data.diameter}</div></div>`;
            }
            if (data.dayLength) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Day Length</div><div class="stat-value">${data.dayLength}</div></div>`;
            }
            if (data.yearLength) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Year Length</div><div class="stat-value">${data.yearLength}</div></div>`;
            }
            if (data.surfaceTemp) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Surface Temp</div><div class="stat-value">${data.surfaceTemp}</div></div>`;
            }
            if (data.numMoons) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Known Moons</div><div class="stat-value">${data.numMoons}</div></div>`;
            }
            if (data.orbitalPeriod) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Orbital Period</div><div class="stat-value">${data.orbitalPeriod}</div></div>`;
            }
            if (data.lastPerihelion) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Last Perihelion</div><div class="stat-value">${data.lastPerihelion}</div></div>`;
            }
            if (data.nextPerihelion) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Next Perihelion</div><div class="stat-value">${data.nextPerihelion}</div></div>`;
            }
            if (data.nucleus) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Nucleus Size</div><div class="stat-value">${data.nucleus}</div></div>`;
            }
            if (data.discoveredBy) {
                statsHtml += `<div class="stat-item" style="grid-column: span 2;"><div class="stat-label">Discovered By</div><div class="stat-value">${data.discoveredBy}</div></div>`;
            }
            if (data.age) {
                statsHtml += `<div class="stat-item"><div class="stat-label">Age</div><div class="stat-value">${data.age}</div></div>`;
            }
            if (data.composition) {
                statsHtml += `<div class="stat-item" style="grid-column: span 2;"><div class="stat-label">Composition</div><div class="stat-value">${data.composition}</div></div>`;
            }
            statsEl.innerHTML = statsHtml;
            
            // Build facts list
            const factsEl = document.getElementById('info-facts');
            if (data.facts && data.facts.length > 0) {
                let factsHtml = '<h4>Quick Facts</h4><ul>';
                data.facts.forEach(fact => {
                    factsHtml += `<li>${fact}</li>`;
                });
                factsHtml += '</ul>';
                factsEl.innerHTML = factsHtml;
                factsEl.style.display = 'block';
            } else {
                factsEl.innerHTML = '';
                factsEl.style.display = 'none';
            }
            
            // Wikipedia link
            const wikiLink = document.getElementById('wiki-link');
            if (data.wiki) {
                wikiLink.href = data.wiki;
                wikiLink.style.display = 'inline-flex';
            } else {
                wikiLink.style.display = 'none';
            }
            
            infoPanel.classList.add('visible');
        }

        // Focus on planet
        function focusOnPlanet(index) {
            const planet = planets[index];
            const worldPos = new THREE.Vector3();
            planet.mesh.getWorldPosition(worldPos);
            
            // Update active state in sidebar
            document.querySelectorAll('.planet-item').forEach(item => item.classList.remove('active'));
            
            // Show info panel with detailed data
            populateInfoPanel(planet.data);
            
            // Set up camera following
            followingPlanetIndex = index;
            followingType = 'planet';
            const targetDistance = planet.data.radius * 5 + 5;
            cameraOffset.set(targetDistance, targetDistance * 0.5, targetDistance);
            
            // Initial camera position
            const targetPosition = worldPos.clone().add(cameraOffset);
            camera.position.copy(targetPosition);
            controls.target.copy(worldPos);
            controls.update();
        }

        // Focus on asteroid
        function focusOnAsteroid(index) {
            const asteroid = asteroids[index];
            const worldPos = new THREE.Vector3();
            asteroid.mesh.getWorldPosition(worldPos);
            
            document.querySelectorAll('.planet-item').forEach(item => item.classList.remove('active'));
            
            // Show info panel with detailed data
            populateInfoPanel(asteroid.data);
            
            followingPlanetIndex = index;
            followingType = 'asteroid';
            const targetDistance = asteroid.data.radius * 10 + 3;
            cameraOffset.set(targetDistance, targetDistance * 0.5, targetDistance);
            
            const targetPosition = worldPos.clone().add(cameraOffset);
            camera.position.copy(targetPosition);
            controls.target.copy(worldPos);
            controls.update();
        }

        // Focus on comet
        function focusOnComet(index) {
            const comet = comets[index];
            const worldPos = new THREE.Vector3();
            comet.mesh.getWorldPosition(worldPos);
            
            document.querySelectorAll('.planet-item').forEach(item => item.classList.remove('active'));
            
            // Show info panel with detailed data
            populateInfoPanel(comet.data);
            
            followingPlanetIndex = index;
            followingType = 'comet';
            const targetDistance = comet.data.radius * 15 + 5;
            cameraOffset.set(targetDistance, targetDistance * 0.5, targetDistance);
            
            const targetPosition = worldPos.clone().add(cameraOffset);
            camera.position.copy(targetPosition);
            controls.target.copy(worldPos);
            controls.update();
        }

        // Stop following when user interacts with controls
        controls.addEventListener('start', () => {
            // User started interacting - stop auto-following
            followingPlanetIndex = null;
            followingType = null;
            document.querySelectorAll('.planet-item').forEach(item => {
                item.classList.remove('active');
            });
        });

        // Animation variables
        let speedMultiplier = 1;
        let showOrbits = true;
        let showLabels = true;
        let showAsteroids = true;
        let showComets = true;
        let vortexMode = false;
        let vortexPosition = 0;
        let followingPlanetIndex = null;
        let followingType = null;
        let cameraOffset = new THREE.Vector3();

        // Tour mode variables
        let tourActive = false;
        let tourIndex = 0;
        let tourTransitionProgress = 0;
        let tourDwellTime = 0;
        const tourDwellDuration = 120; // frames to stay on each object
        const tourTransitionDuration = 90; // frames to transition between objects
        let tourStartPos = new THREE.Vector3();
        let tourStartTarget = new THREE.Vector3();
        let tourEndPos = new THREE.Vector3();
        let tourEndTarget = new THREE.Vector3();
        let tourPhase = 'dwell'; // 'dwell' or 'transition'

        // Build tour list (all celestial bodies)
        function buildTourList() {
            const list = [];
            // Add planets (including Sun and dwarf planets)
            planets.forEach((p, i) => list.push({ type: 'planet', index: i, name: p.data.name, radius: p.data.radius }));
            // Add asteroids
            asteroids.forEach((a, i) => list.push({ type: 'asteroid', index: i, name: a.data.name, radius: a.data.radius }));
            // Add comets
            comets.forEach((c, i) => list.push({ type: 'comet', index: i, name: c.data.name, radius: c.data.radius }));
            return list;
        }
        const tourList = buildTourList();

        // Tour button handler
        const tourBtn = document.getElementById('tour-btn');
        const tourProgressEl = document.getElementById('tour-progress');
        const tourObjectName = document.getElementById('tour-object-name');
        const tourProgressFill = document.getElementById('tour-progress-fill');
        const tourCounter = document.getElementById('tour-counter');

        function getTourTarget(item) {
            if (item.type === 'planet') return planets[item.index];
            if (item.type === 'asteroid') return asteroids[item.index];
            if (item.type === 'comet') return comets[item.index];
            return null;
        }

        function startTourTransition(fromIndex, toIndex) {
            tourPhase = 'transition';
            tourTransitionProgress = 0;
            
            // Store current camera position
            tourStartPos.copy(camera.position);
            tourStartTarget.copy(controls.target);
            
            // Calculate target camera position for next object
            const nextItem = tourList[toIndex];
            const nextTarget = getTourTarget(nextItem);
            if (nextTarget) {
                const worldPos = new THREE.Vector3();
                nextTarget.mesh.getWorldPosition(worldPos);
                
                // Calculate camera distance based on object size
                const viewDistance = Math.max(nextItem.radius * 8, 15);
                tourEndTarget.copy(worldPos);
                tourEndPos.set(
                    worldPos.x + viewDistance * 0.7,
                    worldPos.y + viewDistance * 0.5,
                    worldPos.z + viewDistance * 0.7
                );
            }
        }

        function updateTourUI() {
            const item = tourList[tourIndex];
            tourObjectName.textContent = item.name;
            tourCounter.textContent = `${tourIndex + 1} / ${tourList.length}`;
            const progress = ((tourIndex + 1) / tourList.length) * 100;
            tourProgressFill.style.width = progress + '%';
        }

        tourBtn.addEventListener('click', () => {
            tourActive = !tourActive;
            
            if (tourActive) {
                // Start tour
                tourBtn.textContent = '‚èπ Stop Tour';
                tourBtn.classList.add('active');
                tourProgressEl.classList.add('active');
                
                // Disable following and vortex mode
                followingPlanetIndex = null;
                followingType = null;
                if (vortexMode) {
                    document.getElementById('vortex-toggle').checked = false;
                    document.getElementById('vortex-toggle').dispatchEvent(new Event('change'));
                }
                
                // Start from current object or beginning
                tourIndex = 0;
                tourPhase = 'transition';
                tourTransitionProgress = 0;
                tourDwellTime = 0;
                
                // Start transition to first object
                tourStartPos.copy(camera.position);
                tourStartTarget.copy(controls.target);
                
                const firstItem = tourList[0];
                const firstTarget = getTourTarget(firstItem);
                if (firstTarget) {
                    const worldPos = new THREE.Vector3();
                    firstTarget.mesh.getWorldPosition(worldPos);
                    const viewDistance = Math.max(firstItem.radius * 8, 15);
                    tourEndTarget.copy(worldPos);
                    tourEndPos.set(
                        worldPos.x + viewDistance * 0.7,
                        worldPos.y + viewDistance * 0.5,
                        worldPos.z + viewDistance * 0.7
                    );
                }
                
                updateTourUI();
            } else {
                // Stop tour
                tourBtn.textContent = 'üöÄ Start Tour';
                tourBtn.classList.remove('active');
                tourProgressEl.classList.remove('active');
            }
        });

        // Controls
        document.getElementById('speed-control').addEventListener('input', (e) => {
            speedMultiplier = parseFloat(e.target.value);
        });

        document.getElementById('vortex-toggle').addEventListener('change', (e) => {
            vortexMode = e.target.checked;
            if (vortexMode) {
                // Hide starfield in vortex mode
                starfield.visible = false;
                // Position camera to see the cone from the side (sun leading to the left)
                camera.position.set(-150, 30, 0);
                controls.target.set(0, 30, 0);
                controls.update();
            } else {
                // Show starfield when exiting vortex mode
                starfield.visible = true;
                // Reset to normal view
                solarSystemGroup.position.x = 0;
                vortexPosition = 0;
                
                // Reset all planet/asteroid/comet positions to flat plane
                planets.forEach((planet) => {
                    planet.orbitGroup.position.y = 0;
                    if (planet.orbitLine) {
                        planet.orbitLine.position.y = 0;
                    }
                });
                asteroids.forEach((asteroid) => {
                    asteroid.orbitGroup.position.y = 0;
                    asteroid.orbitLine.position.y = 0;
                });
                comets.forEach((comet) => {
                    comet.orbitGroup.position.y = 0;
                    comet.orbitLine.position.y = 0;
                });
                
                camera.position.set(80, 60, 80);
                controls.target.set(0, 0, 0);
                controls.update();
            }
        });

        document.getElementById('orbit-toggle').addEventListener('change', (e) => {
            showOrbits = e.target.checked;
            orbits.forEach(orbit => orbit.visible = showOrbits);
            asteroids.forEach(a => a.orbitLine.visible = showOrbits && showAsteroids);
            comets.forEach(c => c.orbitLine.visible = showOrbits && showComets);
        });

        document.getElementById('labels-toggle').addEventListener('change', (e) => {
            showLabels = e.target.checked;
            labels.forEach(label => label.style.display = showLabels ? 'block' : 'none');
            asteroids.forEach(a => a.label.style.display = (showLabels && showAsteroids) ? 'block' : 'none');
            comets.forEach(c => c.label.style.display = (showLabels && showComets) ? 'block' : 'none');
        });

        document.getElementById('asteroids-toggle').addEventListener('change', (e) => {
            showAsteroids = e.target.checked;
            asteroids.forEach(a => {
                a.orbitGroup.visible = showAsteroids;
                a.orbitLine.visible = showAsteroids && showOrbits;
                a.label.style.display = (showLabels && showAsteroids) ? 'block' : 'none';
            });
        });

        document.getElementById('comets-toggle').addEventListener('change', (e) => {
            showComets = e.target.checked;
            comets.forEach(c => {
                c.orbitGroup.visible = showComets;
                c.orbitLine.visible = showComets && showOrbits;
                c.label.style.display = (showLabels && showComets) ? 'block' : 'none';
            });
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Vortex mode - move the solar system sideways and create cone
            if (vortexMode) {
                vortexPosition -= 0.5 * speedMultiplier;
                
                // Position each planet in a cone - further planets are lower (trailing behind)
                planets.forEach((planet) => {
                    // Cone offset: further planets trail behind (positive Y = behind the sun in movement direction)
                    const coneOffset = planet.data.distance * 1.0;
                    planet.orbitGroup.position.y = coneOffset;
                    if (planet.orbitLine) {
                        planet.orbitLine.position.y = coneOffset;
                    }
                });
                
                // Position asteroids in the cone
                asteroids.forEach((asteroid) => {
                    const coneOffset = asteroid.data.distance * 1.0;
                    asteroid.orbitGroup.position.y = coneOffset;
                    asteroid.orbitLine.position.y = coneOffset;
                });
                
                // Position comets in the cone (use average distance)
                comets.forEach((comet) => {
                    const avgDistance = comet.semiMajorAxis;
                    const coneOffset = avgDistance * 1.0;
                    comet.orbitGroup.position.y = coneOffset;
                    comet.orbitLine.position.y = coneOffset;
                });
                
                // Move the whole system along negative X axis (sun leads the way)
                solarSystemGroup.position.x = vortexPosition;
                
                // Update sun light position to follow the solar system
                const sunWorldPos = new THREE.Vector3();
                planets[0].mesh.getWorldPosition(sunWorldPos);
                sunLight.position.copy(sunWorldPos);
                
                // Move camera with the solar system
                camera.position.x = vortexPosition - 150;
                controls.target.x = vortexPosition;
                controls.target.y = 30;
            }
            
            // Update planet positions
            planets.forEach((planet, index) => {
                if (planet.data.speed > 0) {
                    planet.angle += planet.data.speed * 0.001 * speedMultiplier;
                    planet.orbitGroup.rotation.y = planet.angle;
                }
                
                // Self rotation
                planet.mesh.rotation.y += 0.01 * speedMultiplier;
                
                // Update labels
                if (showLabels) {
                    const worldPos = new THREE.Vector3();
                    planet.mesh.getWorldPosition(worldPos);
                    worldPos.y += planet.data.radius + 1;
                    
                    const screenPos = worldPos.project(camera);
                    const x = (screenPos.x * 0.5 + 0.5) * container.clientWidth;
                    const y = (-screenPos.y * 0.5 + 0.5) * container.clientHeight;
                    
                    labels[index].style.left = x + 'px';
                    labels[index].style.top = y + 'px';
                    labels[index].style.display = screenPos.z < 1 ? 'block' : 'none';
                }
            });
            
            // Update moon positions
            moons.forEach((moon) => {
                moon.angle += moon.data.speed * 0.002 * speedMultiplier;
                moon.orbitGroup.rotation.y = moon.angle;
                
                // Update moon labels
                if (showLabels) {
                    const worldPos = new THREE.Vector3();
                    moon.mesh.getWorldPosition(worldPos);
                    worldPos.y += moon.data.radius + 0.3;
                    
                    const screenPos = worldPos.project(camera);
                    const x = (screenPos.x * 0.5 + 0.5) * container.clientWidth;
                    const y = (-screenPos.y * 0.5 + 0.5) * container.clientHeight;
                    
                    moon.label.style.left = x + 'px';
                    moon.label.style.top = y + 'px';
                    moon.label.style.display = screenPos.z < 1 ? 'block' : 'none';
                }
            });

            // Update asteroid positions
            asteroids.forEach((asteroid) => {
                if (!showAsteroids) return;
                
                asteroid.angle += asteroid.data.speed * 0.001 * speedMultiplier;
                asteroid.orbitGroup.rotation.y = asteroid.angle;
                
                // Tumbling rotation
                asteroid.mesh.rotation.x += 0.02 * speedMultiplier;
                asteroid.mesh.rotation.z += 0.015 * speedMultiplier;
                
                // Update labels
                if (showLabels && showAsteroids) {
                    const worldPos = new THREE.Vector3();
                    asteroid.mesh.getWorldPosition(worldPos);
                    worldPos.y += asteroid.data.radius + 0.5;
                    
                    const screenPos = worldPos.project(camera);
                    const x = (screenPos.x * 0.5 + 0.5) * container.clientWidth;
                    const y = (-screenPos.y * 0.5 + 0.5) * container.clientHeight;
                    
                    asteroid.label.style.left = x + 'px';
                    asteroid.label.style.top = y + 'px';
                    asteroid.label.style.display = screenPos.z < 1 ? 'block' : 'none';
                } else {
                    asteroid.label.style.display = 'none';
                }
            });

            // Update comet positions (elliptical orbits)
            comets.forEach((comet) => {
                if (!showComets) {
                    comet.label.style.display = 'none';
                    return;
                }
                
                comet.angle += comet.data.speed * 0.001 * speedMultiplier;
                
                // Calculate position on elliptical orbit
                const r = comet.semiMajorAxis * (1 - comet.eccentricity * comet.eccentricity) / 
                          (1 + comet.eccentricity * Math.cos(comet.angle));
                
                comet.mesh.position.x = Math.cos(comet.angle) * r;
                comet.mesh.position.z = Math.sin(comet.angle) * r;
                
                // Update labels
                if (showLabels && showComets) {
                    const worldPos = new THREE.Vector3();
                    comet.mesh.getWorldPosition(worldPos);
                    worldPos.y += comet.data.radius + 1;
                    
                    const screenPos = worldPos.project(camera);
                    const x = (screenPos.x * 0.5 + 0.5) * container.clientWidth;
                    const y = (-screenPos.y * 0.5 + 0.5) * container.clientHeight;
                    
                    comet.label.style.left = x + 'px';
                    comet.label.style.top = y + 'px';
                    comet.label.style.display = screenPos.z < 1 ? 'block' : 'none';
                } else {
                    comet.label.style.display = 'none';
                }
            });
            
            // Tour mode animation
            if (tourActive) {
                const currentItem = tourList[tourIndex];
                const currentTarget = getTourTarget(currentItem);
                
                if (currentTarget) {
                    // Get current world position of target
                    const worldPos = new THREE.Vector3();
                    currentTarget.mesh.getWorldPosition(worldPos);
                    
                    // Update end target to follow moving objects
                    if (tourPhase === 'dwell') {
                        const viewDistance = Math.max(currentItem.radius * 8, 15);
                        tourEndTarget.copy(worldPos);
                        tourEndPos.set(
                            worldPos.x + viewDistance * 0.7,
                            worldPos.y + viewDistance * 0.5,
                            worldPos.z + viewDistance * 0.7
                        );
                    }
                }
                
                if (tourPhase === 'transition') {
                    tourTransitionProgress++;
                    const t = tourTransitionProgress / tourTransitionDuration;
                    // Smooth easing (ease-in-out)
                    const easeT = t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;
                    
                    // Update end position for moving targets
                    if (currentTarget) {
                        const worldPos = new THREE.Vector3();
                        currentTarget.mesh.getWorldPosition(worldPos);
                        const viewDistance = Math.max(currentItem.radius * 8, 15);
                        tourEndTarget.copy(worldPos);
                        tourEndPos.set(
                            worldPos.x + viewDistance * 0.7,
                            worldPos.y + viewDistance * 0.5,
                            worldPos.z + viewDistance * 0.7
                        );
                    }
                    
                    // Interpolate camera position and target
                    camera.position.lerpVectors(tourStartPos, tourEndPos, easeT);
                    controls.target.lerpVectors(tourStartTarget, tourEndTarget, easeT);
                    
                    if (tourTransitionProgress >= tourTransitionDuration) {
                        tourPhase = 'dwell';
                        tourDwellTime = 0;
                    }
                } else if (tourPhase === 'dwell') {
                    tourDwellTime++;
                    
                    // Keep camera following the object while dwelling
                    if (currentTarget) {
                        const worldPos = new THREE.Vector3();
                        currentTarget.mesh.getWorldPosition(worldPos);
                        const viewDistance = Math.max(currentItem.radius * 8, 15);
                        
                        const targetPos = new THREE.Vector3(
                            worldPos.x + viewDistance * 0.7,
                            worldPos.y + viewDistance * 0.5,
                            worldPos.z + viewDistance * 0.7
                        );
                        camera.position.lerp(targetPos, 0.05);
                        controls.target.lerp(worldPos, 0.05);
                    }
                    
                    if (tourDwellTime >= tourDwellDuration) {
                        // Move to next object
                        const nextIndex = (tourIndex + 1) % tourList.length;
                        startTourTransition(tourIndex, nextIndex);
                        tourIndex = nextIndex;
                        updateTourUI();
                    }
                }
            }
            // Follow selected object (when not in tour mode)
            else if (followingPlanetIndex !== null && followingType) {
                let targetObj;
                if (followingType === 'planet') {
                    targetObj = planets[followingPlanetIndex];
                } else if (followingType === 'asteroid') {
                    targetObj = asteroids[followingPlanetIndex];
                } else if (followingType === 'comet') {
                    targetObj = comets[followingPlanetIndex];
                }
                
                if (targetObj) {
                    const worldPos = new THREE.Vector3();
                    targetObj.mesh.getWorldPosition(worldPos);
                    
                    // Smoothly update camera position to follow
                    const targetCameraPos = worldPos.clone().add(cameraOffset);
                    camera.position.lerp(targetCameraPos, 0.1);
                    controls.target.lerp(worldPos, 0.1);
                }
            }
            
            controls.update();
            renderer.render(scene, camera);
        }

        // Handle resize
        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });

        // Start animation
        animate();
    </script>
</body>
</html>